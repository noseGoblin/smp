(function(e){"use strict";function n(){return matchMedia("(min-width:768px)").matches}var t=function(e,n,t){var a;return function(){var i=this,s=arguments,o=function(){a=null,t||e.apply(i,s)},r=t&&!a;clearTimeout(a),a=setTimeout(o,n),r&&e.apply(i,s)}};Function.prototype.bind||(Function.prototype.bind=function(){var e=this,n=Array.prototype.slice.call(arguments),t=n.shift();return function(){return e.apply(t,n.concat(Array.prototype.slice.call(arguments)))}});var a=function(){function n(n,t){var a,i=this;i.defaults={menutype:"dropdown",animationSpeed:400,toggle:"toggle-menu",menu:"cm-menu",htmlClass:"cm-js-menu-active",expanderText:"expand / collapse",landings:!1,expanders:!1,singleClick:!0,fadeObject:"#cmlla"},a=e(n).data()||{},i.options=e.extend({},i.defaults,a,t),i.menu=n,i.$menu=e(n),i.$menuBar=i.$menu.find("."+i.options.menu),i.$menuToggle=i.$menu.find("."+i.options.toggle),i.isActive=!1,i.lastEventType,i.currentFocus=0,i.initialLinks=[],i.currentLinks=[],i.keyHandler=e.proxy(i.keyHandler,i),i.showMenu=e.proxy(i.showMenu,i),i.hideMenu=e.proxy(i.hideMenu,i),i.menuToggle=e.proxy(i.menuToggle,i),i.fadeToggle=e.proxy(i.fadeToggle,i),i.subMenuToggle=e.proxy(i.subMenuToggle,i),i.menuHandler=e.proxy(i.menuHandler,i),i.menuToggleHandler=e.proxy(i.menuToggleHandler,i),i.init()}return n}();a.prototype.init=function(){var n=this;n.$menuToggle.on("click touchstart",n.menuToggle),n.$menu.addClass("cm-js-enabled").attr({role:"navigation",tabindex:"0"}),n.$menuBar.attr("role","menubar");var a=1;if(e("[id^='cm-dropdown']").last().length>0){var i=0;e("[id^='cm-dropdown']").each(function(){var n=e(this).attr("id").split("dropdown")[1];i=n&&i<parseInt(n,10)?parseInt(n,10):i}),a=i+1}n.$menu.on("keydown",n.keyHandler),n.$menu.on("focus",function(){n.$menuToggle.is(":visible")&&!n.isActive&&n.showMenu(),n.$menu.hasClass("cm-js-inFocus")||n.isActive||(n.$menu.addClass("cm-js-inFocus").attr("tabindex","-1"),n.currentLinks[n.currentFocus].attr("tabindex","0").focus())}),n.initialLinks=[],n.$menu.find("."+n.options.menu+" a").each(function(){var i=e(this),s=i.closest("li");if(i.attr({role:"menuitem",tabindex:"-1"}),s.attr("role","presentation"),!s.data("type")&&s.parent().hasClass(n.options.menu)&&s.attr("data-type",n.options.menutype),i.siblings().not("a").length>0){var o=i.siblings(),r="cm-dropdown"+a;if(n.options.expanders){var u=e("<a id='"+r+"' href='#' role='menuitem' aria-haspopup='true' class='has-sub' tabindex='-1'><span><span class='visually-hidden'>"+n.options.expanderText+"</span></span></a>");i.wrap("<div class='expander-wrap'></div>").after(u),u.on("click",n.subMenuToggle)}else i.attr("id")?r=i.attr("id"):i.attr("id","cm-dropdown"+a),i.attr({"aria-haspopup":"true"}).addClass("has-sub").on("click",n.subMenuToggle);var l=o.height()>0;if(o.attr({role:"menu","aria-expanded":l,"aria-hidden":!l,"aria-labelledby":r}),n.options.landings&&!n.options.expanders){var c=e(o.is("ul")?"<li class='link-landing'>"+i.get(0).outerHTML+"</li>":"<div class='link-landing'>"+i.get(0).outerHTML+"</div>");c.children().removeAttr("aria-haspopup class id"),c.find("a").removeClass("has-sub"),o.prepend(c)}if(s.data("type")&&"sliding"===s.data("type")){var d=e("<div class='sub-menu cm-js-inactive'></div>");o.wrap(d);var m=function(){var e,t=n.$menu.innerWidth(),a=s.position().left;e=s.children(".sub-menu"),e.find("> ul > li > ul").innerWidth(t),e.innerWidth(t).css("left","-"+a+"px")},p=t(m,300);e(window).load(function(){m(),e(window).resize(p)})}r==="cm-dropdown"+a&&a++}i.closest("[role]:not(a)").data("type")&&(n.initialLinks.push(i),n.options.expanders&&n.initialLinks.push(u))}),n.currentLinks=n.initialLinks},a.prototype.keyHandler=function(e){var n=this;if(n.$menu.hasClass("cm-js-inFocus")||n.$menu.addClass("cm-js-inFocus").attr("tabindex","-1"),37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode){e.preventDefault();var t=n.currentLinks[n.currentFocus];if(t){var a,i,s,o,r=t.closest("[role]:not(a)").attr("data-type"),u=t.closest("[role=menu]:not(a)").closest("[role=presentation]").attr("data-type");r?37===e.keyCode?i="prev":39===e.keyCode?i="next":40!==e.keyCode&&38!==e.keyCode||(o=!0):38===e.keyCode?i="prev":40===e.keyCode?i="next":39===e.keyCode?o=!0:u||37!==e.keyCode||(s=!0),i&&("prev"===i?n.currentFocus=n.currentFocus-1>=0?n.currentFocus-1:n.currentLinks.length-1:n.currentFocus=n.currentFocus+1<n.currentLinks.length?n.currentFocus+1:0,a=n.currentLinks[n.currentFocus]),a?(t.attr("tabindex","-1"),n.currentLinks[n.currentFocus].attr("tabindex","0").focus()):s?n.$menu.find(".opened").last().find("[aria-haspopup]").first().trigger("click"):o&&(t.closest("li").hasClass("clicked")||n.currentLinks[n.currentFocus].trigger("click"))}}else 27===e.keyCode?(e.preventDefault(),n.$menu.find(".opened").last().find("[aria-haspopup]").first().trigger("click")):32===e.keyCode&&(e.preventDefault(),n.currentLinks[n.currentFocus].trigger("click"))},a.prototype.cleanUpEvents=function(){var n=this;n.$menu.find("li a").off("click",n.subMenuToggle),n.$menu.find("li a[tabindex=0]").attr("tabindex","-1"),n.$menu.off("focus"),n.$menu.off("keydown",n.keyHandler),e("html").off("click touchstart focusin",n.menuHandler),e("html").off("click touchstart",n.menuToggleHandler)},a.prototype.destroy=function(){var e=this;e.$menu.removeClass("cm-js-enabled cm-js-inFocus"),e.$menu.find("li").removeClass("opened animating animated"),e.cleanUpEvents()},a.prototype.showMenu=function(){var t=this;t.isActive=!0,t.$menu.addClass("cm-js-active"),t.$menuToggle.addClass("active"),e("html").addClass(t.options.htmlClass),t.$menu.focus(),e("html").off("click touchstart",t.menuToggleHandler),n()&&setTimeout(function(){e("html").addClass(t.options.htmlClass).on("click touchstart focusin",t.menuToggleHandler)},t.options.animationSpeed),t.fadeToggle(!0)},a.prototype.hideMenu=function(){var t=this;t.isActive=!1,t.$menu.removeClass("cm-js-active cm-js-inFocus"),t.$menuToggle.removeClass("active"),n()&&e("html").removeClass(t.options.htmlClass).addClass("cm-animate-out").off("click touchstart focusin",t.menuToggleHandler),setTimeout(function(){e("html").removeClass("cm-animate-out")},t.options.animationSpeed),t.fadeToggle(!0)},a.prototype.menuToggle=function(e){var n=this;e.preventDefault(),"touchstart"===n.lastEventType&&"click"===e.type||(n.isActive?n.hideMenu():n.showMenu()),n.lastEventType=e.type},a.prototype.fadeToggle=function(n,t){var a=this,i=e(a.$menu),s=e(a.options.fadeObject);n?s.toggleClass("activeMobi"):i.find(".toggle-menu").is(":visible")||(t&&s.hasClass("active")&&!i.find(".cm-menu>li").hasClass("opened")?(s.removeClass("active"),setTimeout(function(){s.removeClass("opened")},a.options.animationSpeed)):!s.hasClass("active")&&i.find(".cm-menu>li").hasClass("opened")&&s.addClass("opened active"))},a.prototype.subMenuToggle=function(t){var a=this,i=e(t.currentTarget),s=i.closest("li"),o=i.closest("[data-type]"),r=o.data("type"),u=e("[aria-labelledby="+i.attr("id")+"]");s.hasClass("opened")?(e("html").off("click touchstart focusin",a.menuHandler),a.options.singleClick&&(t.preventDefault(),"sliding"===r&&s.parents(".sub-menu").hasClass("sub-menu")&&s.parents(".sub-menu").addClass("cm-js-inactive"),s.removeClass("opened animating animated"),a.$menu.find(".opened").length>0&&e("html").on("click touchstart focusin",a.menuHandler),u.attr({"aria-expanded":"false","aria-hidden":"true"}),e.each(a.currentLinks,function(){var e=this;e.attr("tabindex","-1")}),a.currentLinks=[],setTimeout(function(){if(s.data("type"))a.currentLinks=a.initialLinks,a.currentFocus=s.index();else{var n=0;s.closest("[role=menu]").find("a").each(function(t,s){var o=e(s);o.closest("[role=menu]").height()>10&&o.closest("[role=menu]").width()>10&&(a.currentLinks.push(o),i.attr("id")===o.attr("id")&&(a.currentFocus=n),n++)})}i.attr("tabindex","0").focus()},a.options.animationSpeed)),a.fadeToggle(!1,!0)):(t.preventDefault(),s.addClass("opened animating").siblings().removeClass("opened animating animated").find(".opened").removeClass("opened animating animated"),s.siblings().find(".sub-menu").addClass("cm-js-inactive"),"sliding"===r&&s.parents(".sub-menu").length>0&&s.parents(".sub-menu").removeClass("cm-js-inactive"),u.attr({"aria-expanded":"true","aria-hidden":"false"}),e.each(a.currentLinks,function(){var e=this;e.attr("tabindex","-1")}),a.currentLinks=[],setTimeout(function(){s.hasClass("animating")&&s.removeClass("animating").addClass("animated"),s.find("[role=menu]").first().find("a").each(function(n,t){var i=e(t);i.closest("[role=menu]").height()>10&&i.closest("[role=menu]").width()>10&&a.currentLinks.push(i)}),"false"==s.find(".sub-menu-list").first().attr("aria-expanded")&&a.currentLinks[0].trigger("click"),"sub-menu cm-js-inactive"==s.find(".sub-menu").attr("class")&&a.currentLinks[0].trigger("click"),a.currentFocus=0,a.currentLinks[a.currentFocus].attr("tabindex","0").focus(),n()&&e("html").on("click touchstart focusin",a.menuHandler)},a.options.animationSpeed),a.fadeToggle(!1,!1))},a.prototype.menuToggleHandler=function(n){var t=this;e.contains(t.menu,n.target)||(t.$menu.find("."+t.options.toggle).trigger("click"),e("html").removeClass(t.options.htmlClass).off("click touchstart",t.menuToggleHandler))},a.prototype.menuHandler=function(n){var t=this;e.contains(t.menu,n.target)||t.$menu.is(e(n.target))||(t.$menu.find(".opened").removeClass("opened animated animating"),t.$menu.find("[role=menu]").attr({"aria-expanded":"false","aria-hidden":"false"}),t.$menu.find(".sub-menu").addClass("cm-js-inactive"),t.$menu.find("li a[tabindex=0]").attr("tabindex","-1"),t.currentLinks=t.initialLinks,t.currentFocus=0,e(".cm-js-inFocus").removeClass("cm-js-inFocus").attr("tabindex","0"),e("html").off("click touchstart focusin",t.menuHandler),t.fadeToggle(!1,!0))},e.fn.clickMenu=function(){var e,n=this,t=arguments[0],i=Array.prototype.slice.call(arguments,1),s=n.length,o=0;for(o;o<s;o++)if("object"==typeof t||"undefined"==typeof t?n[o].clickMenu=new a(n[o],t):e=n[o].clickMenu[t].apply(n[o].clickMenu,i),"undefined"!=typeof e)return e;return n}})(jQuery);